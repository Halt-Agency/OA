import { type ComponentType } from 'react';
import { type AnyAction as Action, type Reducer } from 'redux';

import { type AppPreferences } from '../app-preferences';
import { type AppUi } from '../app-ui';
import { type Clipboard } from '../clipboard';
import { type CloudApp } from '../cloud-app';
import { type Colors } from '../colors';
import { type EditPost } from '../edit-post';
import { type EmailMarketing } from '../email-marketing';
import { type Events } from '../events';
import { type Fonts } from '../fonts';
import { type GlobalData } from '../global-data';
import { type GlobalLayouts } from '../global-layouts';
import { type Help } from '../help';
import { type History } from '../history';
import { type KeyboardShortcuts } from '../keyboard-shortcuts';
import { type ModalLibrary } from '../modal-library';
import { type Module } from '../module';
import { type ModuleLibrary } from '../module-library';
import { type PageSettings } from '../page-settings';
import { type Rest } from '../rest';
import { type RightClickOptions } from '../right-click-options';
import { type SerializedPost } from '../serialized-post';
import { type Settings } from '../settings';
import { type ShortcodeModule } from '../shortcode-module';
import { type SpamProtection } from '../spam-protection';


export namespace Data {
  export type Select = <TStoreName extends string>(storeName: TStoreName) =>
      TStoreName extends 'divi/app-preferences' ? AppPreferences.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/app-ui' ? AppUi.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/clipboard' ? Clipboard.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/cloud-app' ? CloudApp.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/colors' ? Colors.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/edit-post' ? EditPost.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/email-marketing' ? EmailMarketing.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/events' ? Events.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/fonts' ? Fonts.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/global-data' ? GlobalData.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/global-layouts' ? GlobalLayouts.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/help' ? Help.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/history' ? History.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/keyboard-shortcuts' ? KeyboardShortcuts.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/modal-library' ? ModalLibrary.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/module' ? Module.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/module-library' ? ModuleLibrary.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/page-settings' ? PageSettings.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/rest' ? Rest.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/right-click-options' ? RightClickOptions.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/serialized-post' ? SerializedPost.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/settings' ? Settings.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/shortcode-module' ? ShortcodeModule.Store.Selectors.FunctionMap
      : TStoreName extends 'divi/spam-protection' ? SpamProtection.Store.Selectors.FunctionMap
      : never;

  export type Dispatch = <TStoreName extends string>(storeName: TStoreName) =>
      TStoreName extends 'divi/app-preferences' ? AppPreferences.Store.Actions.FunctionMap
      : TStoreName extends 'divi/app-ui' ? AppUi.Store.Actions.FunctionMap
      : TStoreName extends 'divi/clipboard' ? Clipboard.Store.Actions.FunctionMap
      : TStoreName extends 'divi/cloud-app' ? CloudApp.Store.Actions.FunctionMap
      : TStoreName extends 'divi/colors' ? Colors.Store.Actions.FunctionMap
      : TStoreName extends 'divi/edit-post' ? EditPost.Store.Actions.FunctionMap
      : TStoreName extends 'divi/email-marketing' ? EmailMarketing.Store.Actions.FunctionMap
      : TStoreName extends 'divi/events' ? Events.Store.Actions.FunctionMap
      : TStoreName extends 'divi/fonts' ? Fonts.Store.Actions.FunctionMap
      : TStoreName extends 'divi/global-data' ? GlobalData.Store.Actions.FunctionMap
      : TStoreName extends 'divi/global-layouts' ? GlobalLayouts.Store.Actions.FunctionMap
      : TStoreName extends 'divi/help' ? Help.Store.Actions.FunctionMap
      : TStoreName extends 'divi/history' ? History.Store.Actions.FunctionMap
      : TStoreName extends 'divi/keyboard-shortcuts' ? KeyboardShortcuts.Store.Actions.FunctionMap
      : TStoreName extends 'divi/modal-library' ? ModalLibrary.Store.Actions.FunctionMap
      : TStoreName extends 'divi/module' ? Module.Store.Actions.FunctionMap
      : TStoreName extends 'divi/module-library' ? ModuleLibrary.Store.Actions.FunctionMap
      : TStoreName extends 'divi/page-settings' ? PageSettings.Store.Actions.FunctionMap
      : TStoreName extends 'divi/rest' ? Rest.Store.Actions.FunctionMap
      : TStoreName extends 'divi/right-click-options' ? RightClickOptions.Store.Actions.FunctionMap
      : TStoreName extends 'divi/serialized-post' ? SerializedPost.Store.Actions.FunctionMap
      : TStoreName extends 'divi/settings' ? Settings.Store.Actions.FunctionMap
      : TStoreName extends 'divi/shortcode-module' ? ShortcodeModule.Store.Actions.FunctionMap
      : TStoreName extends 'divi/spam-protection' ? SpamProtection.Store.Actions.FunctionMap
      : never;

  // These types are copied and modified from the last @types/wordpress__data package that is compatible with
  // Divi 5 which is version `4.6.11`. That's why it intentionally uses `{}` as default type. When React 18
  // and its dependencies are bumped, `@wordpress/data` provides its own type so `@types/wordpress__data` are
  // no longer needed. However the built-in type is not compatible with Divi 5 because the select and dispatch
  // value isn't extendable via module augmentation. To fix it, declare correct type for Select, Dispatch, and
  // their derivatives then typecast `@divi/data` into these types.

  // Copied with modification from `@types/wordpress__data` v4.6.11
  // eslint-disable-next-line @typescript-eslint/ban-types
  export type WithSelect = <TSP, TP = {}, TIP = {}>(
    mapSelectToProps: (
      sel: Select,
      ownProps: TP & TIP
    ) => TSP,
  ) => (component: ComponentType<TP & TIP & TSP>) => ComponentType<TP>;

  // Copied with modification from `@types/wordpress__data` v4.6.11
  // eslint-disable-next-line @typescript-eslint/ban-types
  export type WithDispatch = <TDP, TP = {}, TIP = {}>(
    mapDispatchToProps: (
      disp: Dispatch,
      ownProps: TP & TIP,
      registry: { select: Select }
    ) => TDP,
  ) => (component: ComponentType<TP & TIP & TDP>) => ComponentType<TP>;

  // Copied with modification from `@types/wordpress__data` v4.6.11
  export type UseSelect = <T>(
    mapSelect: (s: Select) => T,
    deps?: readonly any[]
  ) => T;

  // Copied with modification from `@types/wordpress__data` v4.6.11
  export type UseDispatch = Dispatch & {
    (): Dispatch;
  }

  export type Subscriber = (callback: () => void) => () => void;

  export interface StoreConfig<TS> {
      reducer: Reducer<TS>;
      actions?: {
          [k: string]: (...args: readonly any[]) => Action | Generator<any>;
      } | undefined;
      selectors?: {
          [k: string]: (state: TS, ...args: readonly any[]) => any;
      } | undefined;
      resolvers?: {
          [k: string]: (...args: readonly any[]) => any;
      } | undefined;
      controls?: {
          [k: string]: (action: Action) => any;
      } | undefined;
      initialState?: TS | undefined;

      /**
       * Use persist with the persistence plugin to persist state.
       *
       * The registry must use the `persistence` plugin.
       *
       * Set to `true` to persist all state, or pass an array of state keys to persist.
       *
       * @example
       *
       * import { plugins, registerStore, use } from '@wordpress/data';
       *
       * use( plugins.persistence, { storageKey: 'example' } );
       *
       * registerStore( 'my-plugin', {
       *   // â€¦
       *   persist: [ 'state-key-to-persist' ],
       * } );
       */
      persist?: true | Array<keyof TS> | undefined;
  }

  export interface Store<TS, TA extends Action = Action> {
    getState(): TS;
    subscribe: Subscriber;
    dispatch(action: TA): TA;
  }

  // Copied with modification from `@types/wordpress__data` v4.6.11
  // eslint-disable-next-line @typescript-eslint/ban-types
  export type RegisterStore = <T = {}>(key: string, config: StoreConfig<T>) => Store<T>;
}
